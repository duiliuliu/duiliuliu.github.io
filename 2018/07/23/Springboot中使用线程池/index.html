<!DOCTYPE html>
<html lang="zh-CN">

  
<head><meta name="generator" content="Hexo 3.8.0">

  <!--

                              ..
                            .' @`._
             ~       ...._.'  ,__.-;
          _..------/`           .-'    ~
         :     __./'       ,  .'-'--.._
      ~   `---(.-'''---.    \`._       `.   ~
        _.--'(  .______.'.-' `-.`        `.
       :      `-..____`-.                  ;
       `.             ````  稻花香里说丰年，  ;   ~
         `-.__           听取人生经验。  __.-'
              ````-----.......-----'''    ~
           ~                   ~   
*-* *-* *-* *-* *-* *-* *-* *-* *-* *-* *-* *-* *-* *-* *-* 
-->

  <meta charset="utf-8">
  <meta name="author" content="对六, pengrui55555@163.com">
  
  
  
  <title>Springboot 中使用线程池 | Duiliuliu</title>

  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  
    <meta name="keywords" content="SpringBoot,SpringBoot,">
  

  <script>
    console.log('\n%c github' + '%c 🎉 https://github.com/duiliuliu🎉\n' + '\n%c 简历 ' + '%c 🔍 更新以下，马上替换🔍  \n' , 'color: #fadfa3; background: #030307; padding:3px 0;', '', 'color: #fadfa3; background: #030307; padding:3px 0;', '');
  </script>

  
    <meta name="description" content="随笔">
  

  

  
    <link rel="icon" href="/images/favicon.ico">
    <link rel="apple-touch-icon" href="/images/touch-icon.png">
  

  <link href="https://cdn.bootcss.com/fancybox/3.5.2/jquery.fancybox.min.css" rel="stylesheet">
  <link rel="stylesheet" href="/css/base.css">
<link rel="stylesheet" href="/icon/iconfont.css">
<link rel="stylesheet" href="/css/github-markdown.css">
<link rel="stylesheet" href="/css/highlight.css">

  <script src="/js/util.js"></script>
<script src="/js/valine.min.js"></script>

  

  
    <link href="https://cdn.bootcss.com/aplayer/1.10.1/APlayer.min.css" rel="stylesheet">
    <script src="https://cdn.bootcss.com/aplayer/1.10.1/APlayer.min.js" async></script>
  

  
    <link href="https://cdn.bootcss.com/social-share.js/1.0.16/css/share.min.css" rel="stylesheet">
  
  
  <script src="//cdn.bootcss.com/jquery/3.3.1/jquery.min.js" async></script>
  
  
    <script src="//cdn.jsdelivr.net/npm/leancloud-storage@3.11.0/dist/av-min.js"></script>
  

</head>

  <body>

    

    <div id="app">

      <div class="header-wrap">
  <header>
    <div class="site-brand">
      <div class="site-title">
        <a href="/"><svg t="1524919571304" class="icon" style="margin-top: 5;margin-bottom: -5;margin-right: 10" viewbox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="1405" xmlns:xlink="http://www.w3.org/1999/xlink" width="55" height="40"><defs><style type="text/css"/></defs><path d="M519.391852 655.664004l5.143137 0 0 0.765433-5.143137 0L519.391852 655.664004 519.391852 655.664004zM461.986421 953.196421l2.953262 1.055029c-7.259334-5.752004-25.818015-19.157315-49.984415-27.129894-28.747741-9.475815-71.581292-12.96529-112.364137 24.231891-0.464581 0.427742-1.047866 0.567935-1.685385 0.405229-9.751085-2.39249-51.969629-106.711394-89.576131-204.463742-2.042519 1.379417-4.027733 2.939959-6.100952 4.581342-3.653203 2.885723-7.614421 5.993504-12.480242 8.460696 47.004547 117.482715 94.16566 232.4307 101.068883 239.10368C336.773651 908.386866 394.807393 929.148725 461.986421 953.196421L461.986421 953.196421zM743.040539 950.431447c-0.64366 0.153496-1.221828 0.01842-1.685385-0.413416-40.797172-37.208437-83.647095-33.721009-112.413256-24.245194-24.045649 7.922437-42.522466 21.217231-49.841152 26.997887l0.271176-0.100284c62.594617-22.972201 127.316687-46.734394 170.756035 45.327348 6.707772-6.489808 51.394531-115.128087 97.024777-229.021044-0.511653-0.23536-1.004887-0.449231-1.455141-0.572028-7.698333-2.072195-13.239536-5.879917-17.913998-9.841136C791.466458 852.460112 752.374114 948.137195 743.040539 950.431447L743.040539 950.431447zM516.283048 657.190777l-0.227174-0.261966c-17.194614-19.894096-173.199691-193.161325-353.35377-152.168702-1.26583 1.962701 8.032954 21.381983 17.873066 39.153742l31.232328-0.881067-16.154935-28.411073 1.083681-0.173962c104.879676-16.950044 280.193517 111.976304 314.27166 137.992841l-0.839111 1.191128c0.949628 0.539282 1.882883 1.083681 2.788509 1.62501l1.503237 0.8913-1.678222 0.493234c-0.561795 0.165776-1.158383 0.98749-1.158383 2.176572l8.861832 291.0027c0 1.331321 0.73678 2.302439 1.391696 2.302439l1.596358 0c0.655939 0 1.39272-0.971118 1.39272-2.276856l8.862855-290.721291c0-1.109264-0.585331-1.935072-1.387603-1.935072l-3.568269 0 2.320858-1.413186c39.282678-23.985274 119.364575-51.532677 204.024743-70.176292 67.964928-14.969946 145.82011-25.104771 160.492274-8.645914l0.308015 0.339738-0.156566 0.429789c-1.726318 4.714372-15.611559 42.691311-34.417881 92.735078 7.316639 1.836835 15.287171 4.197602 22.308075 6.879688 19.531845-49.306986 37.231973-94.376461 49.724495-126.388549-193.349613-19.583011-353.160365 72.461335-397.590274 101.183494l-0.877997-1.251503c47.767933-36.480866 211.434503-154.25113 312.301795-137.948839l1.087774 0.173962-16.152888 28.373211 31.231305 0.813528c9.833973-17.700127 19.134803-37.052894 17.793248-39.065737-179.497117-40.803311-336.053756 133.669372-353.312838 153.699568l-0.233314 0.268106-1.399883 0 0-0.76748-1.685385 0-5.139044 0-1.676176 0 0 0.76748-1.436722 0L516.287141 657.190777zM148.189575 578.905806l-0.155543-0.429789 0.302899-0.339738c14.607696-16.381086 92.526323-6.441713 160.580279 8.316409 81.782631 17.73799 159.444409 43.61638 200.1239 66.535369-46.01808-29.54592-205.276247-120.142288-398.47134-100.571556 11.655458 29.860075 27.838022 71.071685 45.808302 116.484991 7.874341-2.036379 16.295128-3.63376 23.423479-4.684696C162.431951 617.877399 149.827889 583.38891 148.189575 578.905806L148.189575 578.905806zM132.757095 687.280072c-0.661056 3.91517 1.546216 7.232728 2.920516 8.857738 3.337002 3.950985 7.864108 5.516644 9.336646 4.588505 12.595876-7.907087 32.694633-14.82566 59.738569-20.556175 3.251044-0.691755 12.350283-3.613294 11.516288-7.858992-1.093914-5.564739-9.55461-6.729262-16.458857-6.729262-2.217505 0-4.13518 0.121773-5.285377 0.193405-0.446162 0.027629-0.788969 0.048095-1.01205 0.060375-10.218736 0.349971-37.748742 4.875031-52.061726 11.208273C137.895115 678.619832 133.426337 683.335227 132.757095 687.280072L132.757095 687.280072zM139.60813 715.676819c1.680269 5.915733 4.780887 8.92016 9.213849 8.92016 3.095501 0 5.754051-1.471514 6.494924-1.922792l0.682545-0.413416c6.164397-3.774977 24.920576-15.263635 53.91391-18.61701 12.890588-1.488911 27.972075-7.912204 27.364231-13.657045-0.200568-1.944282-0.806365-7.836479-13.252839-7.836479-6.547113 0-14.192234 1.555425-20.801768 3.065825-15.765055 3.62762-42.147936 11.713786-56.292074 17.975397C143.670655 704.632275 137.984143 709.941188 139.60813 715.676819L139.60813 715.676819zM218.057853 707.125049c-0.329505 0.039909-0.610914 0.075725-0.839111 0.098237-13.143345 1.228991-37.343513 7.423063-59.398832 18.119683-3.426029 1.664919-7.2798 5.961782-7.525394 9.998725-0.277316 4.604878 1.490957 7.504928 3.0208 9.127891 2.305509 2.455935 5.195326 3.327792 7.132444 3.327792 0.624217 0 1.181919-0.088004 1.659803-0.251733 9.397021-3.317559 16.104793-7.123234 22.596647-10.800997 5.963829-3.384074 12.132318-6.879688 20.165272-9.809413 0.285502-0.107447 1.013073-0.303922 2.061962-0.587378 20.999266-5.609765 23.64042-9.920954 23.344684-11.992125-0.727571-5.110391-3.53757-7.486508-8.836249-7.486508C220.122885 706.869223 218.927663 707.014532 218.057853 707.125049L218.057853 707.125049zM203.405131 732.825384l-0.410346 0.148379c-9.522887 3.355421-15.303544 7.039323-26.811646 14.386662-1.992377 1.2689-4.151553 2.648316-6.528694 4.151553-1.651616 1.041726-2.614547 2.178619-2.861164 3.37998-0.23536 1.167592 0.166799 2.520403 1.200338 4.019547 2.675946 3.873214 4.740978 4.323469 6.067182 4.323469l0 0c1.373277 0 2.78237-0.572028 4.14746-1.119497 0.998747-0.402159 2.034333-0.819668 3.072989-1.019213 9.760295-1.889023 16.008602-6.829546 22.056342-11.612479 2.744507-2.166339 5.335519-4.219091 8.185426-5.938246 0.172939-0.106424 0.397043-0.234337 0.665149-0.385786 1.984191-1.134847 7.261381-4.14746 7.975649-7.846712 0.280386-1.480724-0.189312-2.967588-1.441838-4.53734-0.436952-0.545422-1.512447-0.849344-3.037173-0.849344C211.464691 729.925335 205.399555 732.106 203.405131 732.825384L203.405131 732.825384zM840.178903 669.444868c-1.847068-0.25378-5.28026-0.727571-9.035794-0.727571-5.2864 0-11.860119 0.985444-13.140275 5.67014-1.133823 4.168949 7.723915 7.740288 10.924817 8.662287 26.551726 7.67889 46.101991 16.031115 58.096163 24.825408 0.320295 0.234337 0.816598 0.36225 1.431605 0.36225 2.163269 0 5.812379-1.608637 8.601912-4.682649 2.304486-2.530636 3.422959-5.446036 3.157923-8.204869-0.378623-3.985778-4.498454-9.014304-7.928576-10.842952-13.818727-7.351432-40.947598-13.848403-51.112098-14.938224C840.951499 669.544129 840.613808 669.500127 840.178903 669.444868L840.178903 669.444868zM884.934223 710.188828c-13.651928-7.259334-39.383986-17.234523-54.844096-21.988804-7.506974-2.300392-16.116049-4.657067-23.052019-4.657067-8.991792 0-10.737552 3.967358-11.266601 6.949272-1.013073 5.688559 13.563924 13.187347 26.307156 15.603373 28.65462 5.432733 46.536896 18.237363 52.40965 22.449291l0.666172 0.471744c0.797156 0.565888 3.65218 2.413979 7.014764 2.413979 4.086062 0 7.169283-2.778276 9.166777-8.258081C893.371382 717.571982 888.080889 711.866027 884.934223 710.188828L884.934223 710.188828zM872.474446 731.498156c-21.234627-12.267395-44.921095-20.191878-57.945737-22.361287-0.220011-0.035816-0.49528-0.094144-0.812505-0.155543-1.087774-0.217964-2.735297-0.547469-4.476965-0.547469-4.53734 0-7.231705 2.248204-8.238638 6.873548-0.444115 2.044566 1.88186 6.53995 22.425755 13.646811 1.02126 0.352017 1.730411 0.605797 2.00875 0.727571 7.798617 3.507894 13.69593 7.440459 19.404955 11.246135 6.206352 4.14132 12.619412 8.4126 21.75549 12.403494 0.584308 0.255827 1.324158 0.387833 2.145873 0.387833 4.308119 0 10.416234-3.63376 10.512425-11.70253C879.301945 737.969545 875.775632 733.406622 872.474446 731.498156L872.474446 731.498156zM826.860573 735.851301l-0.397043-0.173962c-5.692652-2.532683-9.987468-3.815909-12.769838-3.815909-0.799202 0-1.856277 0.11768-2.357697 0.653893-1.363044 1.480724-1.939165 2.923586-1.765203 4.420683 0.442068 3.739161 5.485945 7.125281 7.386224 8.396227 0.254803 0.176009 0.468674 0.318248 0.633427 0.431835 2.719948 1.922792 5.154393 4.155646 7.739265 6.52153 5.685489 5.202489 11.559267 10.585079 21.155832 13.168927 1.02433 0.276293 2.028193 0.76748 2.997264 1.245364 1.429559 0.701988 2.912329 1.425466 4.411473 1.425466 1.941212 0 3.90596-1.264806 6.006807-3.883447 1.137916-1.423419 1.638313-2.744507 1.487887-3.921309-0.159636-1.218758-1.035586-2.424212-2.610454-3.581572-2.254344-1.664919-4.296863-3.189645-6.186909-4.594645C841.634044 743.983515 836.128657 739.886197 826.860573 735.851301L826.860573 735.851301zM826.860573 735.851301" fill="#399ea8" p-id="1406"/><path d="M135.362432 563.761897 276.571525 933.502893 520.485767 949.820534 769.2689 928.898015 907.408073 569.735959 772.338818 563.761897 709.408557 592.759325 655.688052 602.819448 629.594767 611.177813 580.352249 626.183576 541.605783 641.875976 528.7725 657.190777 524.536013 656.429437 462.567659 626.183576 360.990193 594.972736 219.7811 563.761897Z" fill="#399ea8" p-id="1407"/><path d="M255.660262 315.224358c0 67.713194 26.611078 129.415488 70.39835 175.036525C182.678064 546.322713 83.941296 669.785629 83.941296 846.798159c0 160.327522 849.423963 184.136787 858.580506 0 8.902764-177.295985-94.468558-301.329906-241.517659-357.140003 43.214221-45.591361 69.799716-106.750279 69.799716-174.46552 0-140.746558-115.361401-254.883061-257.57231-254.883061S255.660262 174.446078 255.660262 315.224358L255.660262 315.224358zM312.896848 315.224358c0-109.611443 89.580225-198.247156 200.334701-198.247156 110.7555 0 200.334701 88.661296 200.334701 198.247156 0 79.30316-47.219441 147.848303-115.361401 179.556469C762.765789 532.729114 885.28624 650.555659 885.28624 825.02118c0 134.539182-744.106312 127.439484-744.106312 0 0-174.46552 122.493845-292.260343 287.054785-330.240353C360.118336 463.072661 312.896848 394.527518 312.896848 315.224358L312.896848 315.224358zM312.896848 315.224358" fill="#399ea8" p-id="1408"/><path d="M140.11262 579.11149 162.113703 626.183576 204.58091 566.575989 168.765193 563.761897Z" fill="#399ea8" p-id="1409"/><path d="M879.780853 641.875976 912.012951 574.340837 879.780853 563.761897 844.477812 563.761897 816.850591 569.736982Z" fill="#399ea8" p-id="1410"/></svg>Duiliuliu</a>
      </div>
    </div>
    <nav class="site-navigation">
      <ul class="nav-menu">
      
        <li class="nav-item" data-path="/">
          
            
            <a href="/" target="_self">
             <img src="/icon/主页.svg">
              主页
            </a>
          
        </li>
      
        <li class="nav-item" data-path="/archives/">
          
            
            <a href="/archives/" target="_self">
             <img src="/icon/归档.svg">
              归档
            </a>
          
        </li>
      
        <li class="nav-item" data-path="/categories/">
          
            
            <a href="/categories/" target="_self">
             <img src="/icon/分类.svg">
              分类
            </a>
          
        </li>
      
        <li class="nav-item" data-path="/tags/">
          
            
            <a href="/tags/" target="_self">
             <img src="/icon/标签.svg">
              标签
            </a>
          
        </li>
      
        <li class="nav-item" data-path="/about/">
          
            
            <a href="/about/" target="_self">
             <img src="/icon/关于我.svg">
              关于
            </a>
          
        </li>
      
      <li class="nav-item">
          <input type="text" id="#nav-search-btn" style="width: 200px;" results="0">
      </li>
      </ul>
    </nav>
    <i class="iconfont icon-menu"></i>
  </header>
</div>

<script>
  let links = document.querySelectorAll('.nav-item');
  for(let link of links){
    let childrenLink = link.querySelector('ul');
    link.addEventListener('mouseenter', () => {
      if(childrenLink) {
        childrenLink.className = "nav-menu--dropdown active";
      }
    })
    link.addEventListener('mouseleave', () => {
      if(childrenLink) {
        childrenLink.className = "nav-menu--dropdown";
      }
    })
  }
  let rootRealPath = getRealPath(window.location.pathname, true);
  for(let link of links) {
    let linkPath = link.getAttribute("data-path");
    if(linkPath && getRealPath(linkPath, true) === rootRealPath) {
      link.className = "nav-item hover";
    }
  }

  let iconMenu = document.querySelector("i.iconfont.icon-menu"),
    iconMenuClicked = false;
  let navDOM = document.querySelector("nav.site-navigation");
  iconMenu.addEventListener("click", () => {
    iconMenuClicked 
      ? navDOM.className = "site-navigation active"
      : navDOM.className = "site-navigation";
    iconMenuClicked = !iconMenuClicked;
  })
</script>

      








<div class="container post-index">

  

<div class="post">
  <h1 class="article-title">
    <span>Springboot 中使用线程池</span>
  </h1>
  <div class="article-top-meta">
    <span>
      发布 : 
      2018-07-23
    </span>
    
      <span>
        分类 : 
          <a href="/categories/SpringBoot/">
            SpringBoot
          </a>
      </span>
    
    
      <span>
        浏览 : <span class="article-timer" data-identity="Springboot中使用线程池"></span>
      </span>
    
  </div>

  

  <div class="article-content">
    <div class="markdown-body">
      <h1 id="Springboot-中使用线程池"><a href="#Springboot-中使用线程池" class="headerlink" title="Springboot 中使用线程池"></a>Springboot 中使用线程池</h1><p>在很多场景下，我们需要多线程更加快速高效的执行任务，池化资源可以更好地对线程进行管理控制。</p>
<p>如果并发的请求数量非常多，但每个线程执行的时间很短，这样就会频繁的创建和销毁线程，如此一来会大大降低系统的效率。可能出现服务器在为每个请求创建新线程和销毁线程上花费的时间和消耗的系统资源要比处理实际的用户请求的时间和资源更多。</p>
<p>springboot 中提供了简单高效的线程池配置方案。不过我们需要先了解下线程池</p>
<h2 id="Java-线程池"><a href="#Java-线程池" class="headerlink" title="Java 线程池"></a>Java 线程池</h2><p>java.uitl.concurrent.ThreadPoolExecutor 类是线程池中最核心的一个类</p>
<p>我们来看一下 ThreadPoolExecutor 的具体实现</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">public class ThreadPoolExecutor extends AbstractExecutorService &#123;</span><br><span class="line">    .....</span><br><span class="line">    public ThreadPoolExecutor(int corePoolSize,int maximumPoolSize,long keepAliveTime,TimeUnit unit,</span><br><span class="line">            BlockingQueue&lt;Runnable&gt; workQueue);</span><br><span class="line"></span><br><span class="line">    public ThreadPoolExecutor(int corePoolSize,int maximumPoolSize,long keepAliveTime,TimeUnit unit,</span><br><span class="line">            BlockingQueue&lt;Runnable&gt; workQueue,ThreadFactory threadFactory);</span><br><span class="line"></span><br><span class="line">    public ThreadPoolExecutor(int corePoolSize,int maximumPoolSize,long keepAliveTime,TimeUnit unit,</span><br><span class="line">            BlockingQueue&lt;Runnable&gt; workQueue,RejectedExecutionHandler handler);</span><br><span class="line"></span><br><span class="line">    public ThreadPoolExecutor(int corePoolSize,int maximumPoolSize,long keepAliveTime,TimeUnit unit,</span><br><span class="line">        BlockingQueue&lt;Runnable&gt; workQueue,ThreadFactory threadFactory,RejectedExecutionHandler handler);</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>可以看到 ThreadPoolExecutor 继承自 AbstractExecutorService，有四个构造器。这四个构造器中有 5 个参数是必须有，有两个是可有可不有的。</p>
<p>这些参数的含义分别是：</p>
<ul>
<li><p>int corePoolSize</p>
<p>核心池的大小。在创建了线程池后，默认情况下，线程池中并没有任何线程，而是等待有任务到来才创建线程去执行任务，除非调用了 prestartAllCoreThreads()或者 prestartCoreThread()方法，这两个方法从名字可以吧看出，是预创建线程的意思。</p>
<p>默认情况下，在创建了线程池后，线程池中的线程数为 0 ，当有任务来之后，就会创建一个线程去执行任务，当线程池中线程数达到 corePoolSize 后，就会把到达的任务添加进缓冲队列中。</p>
</li>
<li><p>int maximumPoolSize</p>
<p>线程池最大线程数，这个参数也是一个非常重要的参数，它表示在线程池中最多能创建多少个线程；</p>
</li>
<li><p>long keepAliveTime</p>
<p>表示非核心线程没有任务执行时最多保持多久时间会终止；默认情况下，是作用于非核心线程的，也就是说，只有当线程池中的线程数大于 corePoolSize 时，keepAliveTime 才会起作用，直到线程池中的线程数不大于 corePoolSize，即当线程池中的线程数大于 corePoolSize 时，如果一个线程空闲的时间达到 keepAliveTime，则会终止，直到线程池中的线程数不超过 corePoolSize。</p>
<p>但是如果调用了 allowCoreThreadTimeOut(boolean)方法，在线程池中的线程数不大于 corePoolSize 时，keepAliveTime 参数也会起作用，直到线程池中的线程数为 0；</p>
</li>
<li><p>TimeUnit unit</p>
<p>参数 keepAliveTime 的时间单位，有 7 种取值，在 TimeUnit 类中有 7 种静态属性：</p>
<pre><code>TimeUnit.DAYS;               //天
TimeUnit.HOURS;             //小时
TimeUnit.MINUTES;           //分钟
TimeUnit.SECONDS;           //秒
TimeUnit.MILLISECONDS;      //毫秒
TimeUnit.MICROSECONDS;      //微妙
TimeUnit.NANOSECONDS;       //纳秒
</code></pre></li>
<li><p>BlockingQueue<runnable> workQueue</runnable></p>
<p>等待队列，当任务提交时，如果线程池中的线程数量大于等于 corePoolSize 的时候，把该任务封装成一个 Worker 对象放入等待队列；</p>
<p>当提交一个新的任务到线程池以后, 线程池会根据当前线程池中正在运行着的线程的数量来决定对该任务的处理方式，主要有以下几种处理方式(排队策略):</p>
<ol>
<li><p>直接提交</p>
<p>这种方式常用的队列是 SynchronousQueue，但现在还没有研究过该队列，这里暂时还没法介绍；</p>
</li>
<li><p>使用无界队列</p>
<p>一般使用基于链表的阻塞队列 LinkedBlockingQueue。如果使用这种方式，那么线程池中能够创建的最大线程数就是 corePoolSize，而 maximumPoolSize 就不会起作用了（后面也会说到）。当线程池中所有的核心线程都是 RUNNING 状态时，这时一个新的任务提交就会放入等待队列中</p>
</li>
<li><p>使用有界队列</p>
<p>一般使用 ArrayBlockingQueue。使用该方式可以将线程池的最大线程数量限制为 maximumPoolSize，这样能够降低资源的消耗，但同时这种方式也使得线程池对线程的调度变得更困难，因为线程池和队列的容量都是有限的值，所以要想使线程池处理任务的吞吐率达到一个相对合理的范围，又想使线程调度相对简单，并且还要尽可能的降低线程池对资源的消耗，就需要合理的设置这两个数量</p>
<ul>
<li>如果要想降低系统资源的消耗（包括 CPU 的使用率，操作系统资源的消耗，上下文环境切换的开销等）, 可以设置较大的队列容量和较小的线程池容量, 但这样也会降低线程处理任务的吞吐量。</li>
<li>如果提交的任务经常发生阻塞，那么可以考虑通过调用 setMaximumPoolSize() 方法来重新设定线程池的容量。</li>
<li>如果队列的容量设置的较小，通常需要将线程池的容量设置大一点，这样 CPU 的使用率会相对的高一些。但如果线程池的容量设置的过大，则在提交的任务数量太多的情况下，并发量会增加，那么线程之间的调度就是一个要考虑的问题，因为这样反而有可能降低处理任务的吞吐量。</li>
</ul>
</li>
</ol>
</li>
<li><p>ThreadFactory threadFactory</p>
<p>它是 ThreadFactory 类型的变量，用来创建新线程。默认使用 Executors.defaultThreadFactory() 来创建线程。使用默认的 ThreadFactory 来创建线程时，会使新创建的线程具有相同的 NORM_PRIORITY 优先级并且是非守护线程，同时也设置了线程的名称。</p>
</li>
<li><p>RejectedExecutionHandler handler</p>
<p>它是 RejectedExecutionHandler 类型的变量，表示线程池的饱和策略。如果阻塞队列满了并且没有空闲的线程，这时如果继续提交任务，就需要采取一种策略处理该任务。线程池提供了 4 种策略(拒绝策略)：</p>
<ol>
<li>AbortPolicy 直接抛出异常，这是默认策略；</li>
<li>CallerRunsPolicy 用调用者所在的线程来执行任务；</li>
<li>DiscardOldestPolicy 丢弃阻塞队列中靠最前的任务，并执行当前任务；</li>
<li>DiscardPolicy 直接丢弃任务；</li>
</ol>
</li>
</ul>
<p>其他几个构造器分别依赖这个构造器，我们只需看这个构造器就可以了</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">public ThreadPoolExecutor(int corePoolSize,</span><br><span class="line">                          int maximumPoolSize,</span><br><span class="line">                          long keepAliveTime,</span><br><span class="line">                          TimeUnit unit,</span><br><span class="line">                          BlockingQueue&lt;Runnable&gt; workQueue,</span><br><span class="line">                          ThreadFactory threadFactory,</span><br><span class="line">                          RejectedExecutionHandler handler) &#123;</span><br><span class="line">    if (corePoolSize &lt; 0 ||</span><br><span class="line">        maximumPoolSize &lt;= 0 ||</span><br><span class="line">        maximumPoolSize &lt; corePoolSize ||</span><br><span class="line">        keepAliveTime &lt; 0)</span><br><span class="line">        throw new IllegalArgumentException();</span><br><span class="line">    if (workQueue == null || threadFactory == null || handler == null)</span><br><span class="line">        throw new NullPointerException();</span><br><span class="line">    this.corePoolSize = corePoolSize;</span><br><span class="line">    this.maximumPoolSize = maximumPoolSize;</span><br><span class="line">    this.workQueue = workQueue;</span><br><span class="line">    this.keepAliveTime = unit.toNanos(keepAliveTime);</span><br><span class="line">    this.threadFactory = threadFactory;</span><br><span class="line">    this.handler = handler;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这段代码的逻辑：</p>
<ul>
<li>判断核心线程数：<ol>
<li>如果运行的线程少于 corePoolSize，则创建新线程来处理任务，即使线程池中的其他线程是空闲的；</li>
<li>如果线程池中的线程数量大于等于 corePoolSize 且小于 maximumPoolSize，则只有当 workQueue 满时才创建新的线程去处理任务；</li>
<li>如果设置的 corePoolSize 和 maximumPoolSize 相同，则创建的线程池的大小是固定的，这时如果有新任务提交，若 workQueue 未满，则将请求放入 workQueue 中，等待有空闲的线程去从 workQueue 中取任务并处理；</li>
<li>如果运行的线程数量大于等于 maximumPoolSize，这时如果 workQueue 已经满了，则通过 handler 所指定的策略来处理任务；</li>
</ol>
</li>
<li>判断任务队列对象或者线程工厂对象或者拒绝处理对象是否为空</li>
<li>赋值</li>
</ul>
<h2 id="springboot-中线程池配置与使用"><a href="#springboot-中线程池配置与使用" class="headerlink" title="springboot 中线程池配置与使用"></a>springboot 中线程池配置与使用</h2><p>springboot 中通常是使用@Configuration 配置线程池，然后使用@Bean 注解将线程池添加到 spring 容器中</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">@Configuration</span><br><span class="line">public class ThreadPoolConfig&#123;</span><br><span class="line"></span><br><span class="line">    @Bean</span><br><span class="line">    public ExecutorService getThreadPool()&#123;</span><br><span class="line">        return newFixedThreadPool(5);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>对于线程池的使用，只需通过指定名称进行加载</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">@Autowired</span><br><span class="line">private ExecutorService downloadQueueThreadPool;</span><br><span class="line"></span><br><span class="line">public void todo()&#123;</span><br><span class="line">    executorService.execute(()-&gt;&#123;</span><br><span class="line">        System.out.println(&quot;线程池打印&quot;);</span><br><span class="line">        // 此处内部类引入外部变量需要为泪下按量或者使用final修饰的变量，所以若需要迭代输出，可通过内部类的方式进行输出</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>此处有另外的引入方式,即通过注解@Autowired</strong><br>&lt;!–<br>// 在config中配置 @Bean(name = “downloadQueueThreadPool”)<br>@resource(name=”downloadQueueThreadPool”)<br>private ExecutorService downloadQueueThreadPool;</p>
<p>注解@Autowired 与@resource 的区别是一个是 spring 提供，另一个是 Java 规范，作用类似，<br>@Autowired注释进行byType注入。<br>@Resource的作用相当于@Autowired，只不过@Autowired按byType自动注入，而@Resource默认按 byName自动注入罢了</p>
<p>@Resource有两个属性是比较重要的，分是name和type，Spring将@Resource注解的name属性解析为bean的名字，而type属性则解析为bean的类型。<br>所以如果使用name属性，则使用byName的自动注入策略，<br>而使用type属性时则使用byType自动注入策略。<br>如果既不指定name也不指定type属性，这时将通过反射机制使用byName自动注入策略。<br> –&gt;<br><strong>@Configuration 的作用</strong></p>
<!-- 
@Configuration 注解本质上还是 @Component

都可以作为配置类

 -->
<p><strong>@Bean 的作用</strong></p>
<!-- 
Spring的@Bean注解用于告诉方法，产生一个Bean对象，然后这个Bean对象交给Spring管理。产生这个Bean对象的方法Spring只会调用一次，随后这个Spring将会将这个Bean对象放在自己的IOC容器中。
  -->
<p><strong>同步与异步</strong></p>
<p>所谓异步则是：你在餐厅带你了一份饭，然后告诉他们你去外面做其他事情去了,让他们饭做好了叫你(回调)<br>而同步得分执行则是：你一直呆在餐厅中等待饭做好才去吃饭，中间时间段内并不能去做其他的事情</p>
<p>这儿就需要使用注解 @Async 与@EnableAsync</p>
<h2 id="demo-示例"><a href="#demo-示例" class="headerlink" title="demo 示例"></a>demo 示例</h2><ul>
<li><p>建立 springboot 项目</p>
<p>这儿我们我们选择依赖 Rest Repositories</p>
<p>点击完成便构建了一个 Springboot 项目。</p>
<p><strong>Rest Repositories 依赖的作用</strong></p>
<!-- 
   RestController注解会返回json，而Controller可以返回jsp页面
 -->
<p>新建一个 DemoController 类</p>
<p>新建立一个 DemoController</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">@RestController</span><br><span class="line">@RequestMapping(&quot;/demo&quot;)</span><br><span class="line">public class DemoController &#123;</span><br><span class="line"></span><br><span class="line">    @GetMapping</span><br><span class="line">    public Map&lt;String,Object&gt; sayHello()&#123;</span><br><span class="line">        Map&lt;String,Object&gt; map = new HashMap&lt;&gt;();</span><br><span class="line">        map.put(&quot;message&quot;,&quot;Hello world&quot;);</span><br><span class="line">        return map;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>配置线程池</p>
<p>在 config 包下建立 ThreadPoolConfig</p>
<p>配置我们需要的线程池</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">@Configuration</span><br><span class="line">public class ThreadPoolConfig &#123;</span><br><span class="line"></span><br><span class="line">    @Bean</span><br><span class="line">    public ExecutorService getThreadPool() &#123;</span><br><span class="line">        return Executors.newFixedThreadPool(5);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>使用线程池</p>
<p>这里我们有可以看看同步、异步、线程池的效果</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line">@Service</span><br><span class="line">public class CookService &#123;</span><br><span class="line"></span><br><span class="line">    @Autowired</span><br><span class="line">    private ExecutorService executorService;</span><br><span class="line">//	@Bean(name= &quot;downloadQueueThreadPool&quot;)</span><br><span class="line">//	@Resource(name = &quot;downloadQueueThreadPool&quot;)</span><br><span class="line">//	private ExecutorService downloadQueueThreadPool;</span><br><span class="line"></span><br><span class="line">    public String cookOneFood() &#123;</span><br><span class="line">        return &quot;同步完成：  &quot; + cook();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Async</span><br><span class="line">    public String cookAsyncFood() &#123;</span><br><span class="line">        return &quot;异步完成：  &quot; + cook();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public List&lt;String&gt; cookMultiFood(int count) &#123;</span><br><span class="line">        final List&lt;Future&gt; futureList = new ArrayList&lt;&gt;();</span><br><span class="line">        final List&lt;String&gt; resultList = new ArrayList&lt;&gt;();</span><br><span class="line"></span><br><span class="line">        for(int i = 0; i &lt; count; i++) &#123;</span><br><span class="line">            futureList.add(</span><br><span class="line">                executorService.submit(()-&gt;&#123;</span><br><span class="line">                    return cook();</span><br><span class="line">                &#125;)</span><br><span class="line">            );</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        for(Future future: futureList) &#123;</span><br><span class="line">            try &#123;</span><br><span class="line">                resultList.add(&quot;多线程完成： &quot; + future.get());</span><br><span class="line">            &#125; catch (InterruptedException | ExecutionException e) &#123;</span><br><span class="line">                // TODO Auto-generated catch block</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        return resultList;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private String cook() &#123;</span><br><span class="line">        try &#123;</span><br><span class="line">            Thread.sleep(3000);</span><br><span class="line">        &#125; catch (InterruptedException e) &#123;</span><br><span class="line">            // TODO Auto-generated catch block</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        return &quot;一份煮饭&quot;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>然后修改相应的 controller</p>
</li>
</ul>
    </div>
  </div>
  
    <div class="copy-right">
      <div class="markdown-body">
        <blockquote>
        
        
          本文作者 : 对六 <br>
        
        原文链接 : <a href>http://duiliuliu.github.io/2018/07/23/Springboot中使用线程池/</a><br>
        版权声明 : 本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> 许可协议。转载请注明出处！
        </blockquote>
      </div>
    </div>
  
  
  
    <div class="social-share" style="margin-top: -2rem" data-wechat-qrcode-title="<p>微信扫一扫</p>" data-wechat-qrcode-helper="<p>微信右上角, 扫一扫分享</p>" data-sites="douban, google, facebook, twitter">
  <span style="color: #6b7487; font-size: 1.4rem;">分享到: </span>
</div>
<script src="https://cdn.bootcss.com/social-share.js/1.0.16/js/social-share.min.js" async></script>
  

  
    <div id="reward">
  
    <p id="reward-meta">你我共勉！</p>
  
  <button id="reward-btn">
    
    <span>共勉</span>
  </button>
  <div id="reward-qrcode">
    
      <div class="reward-qrcode--container">
        <img class="qrcode-img" src="/images/wechat.png" alt="微信">
        <p class="qrcode-meta">微信</p>
      </div>
    
      <div class="reward-qrcode--container">
        <img class="qrcode-img" src="/images/alipay.png" alt="支付宝">
        <p class="qrcode-meta">支付宝</p>
      </div>
    
  </div>

</div>

<script>
  (() => {
    let button = document.querySelector('#reward-btn'),
      qrcode = document.querySelector('#reward-qrcode'),
      display = false;
    
    button.addEventListener('click', () => {
      qrcode.style.display = display ? 'none' : 'block'
      display = !display
    }, false)
  })()
</script>
  

  <div class="article-footer">
    <div class="article-meta pull-left">
      <span>
        
          <i class="iconfont icon-06tags"></i>标签: 
          
          <span class="span--tag">
            <a href="/tags/SpringBoot/">
              #SpringBoot
            </a>
          </span>
          
        
      </span>
    </div>
    <div class="article-meta pull-right">
    </div>
  </div>
</div>


  <aside id="sidebar">
    <p id="sidebar-header"></p>
    <ol id="sidebar-toc"></ol>
    <img id="sidebar-icon">
  </aside>
  <script async>setTimeout(generateToc, 10);</script>


  <nav class="post-navigation">
    
      <div class="nav-pre">
        <i class="iconfont icon-prev"></i>
        上一篇:
        <a href="/2018/07/07/2018-07-07-jest与enzyme对react项目自动化测试/" target="_self">jest与enzyme对react项目自动化测试</a>
      </div>
    
    
      <div class="nav-next">
        下一篇:
        <a href="/2018/07/25/2018-07-25-elasticsearch入门/" target="_self">elasticsearch入门</a>
        <i class="iconfont icon-next"></i>
      </div>
    
  </nav>

  
    <a href="#comment" class="comment-anchor"></a>
<div class="comment-title"><i class="iconfont icon-footprint"></i> 留下足迹 <i class="iconfont icon-footprint"></i></div>
<div id="vcomments"></div>

<script defer>
  if( true ) {
    let path = getRealPath()
    new Valine({
      el: "#vcomments",
      appId: "VPNwETUGMJnwGnY6Pc7GaVna-gzGzoHsz",
      appKey: "niJbsuSCKuploWnG8Qvbgb5P",
      notify: false,
      verify: false,
      avatar: "robohash",
      placeholder: "正确填写邮箱, 才能及时收到回复哦♪(^∇^*)",
      path
    });
  }
</script>
   

  
    <script defer>
const valineAPI = (() => {
  try {
    AV.init("VPNwETUGMJnwGnY6Pc7GaVna-gzGzoHsz", "niJbsuSCKuploWnG8Qvbgb5P");
  } catch(error) {}
  const isExist = (identity) => {
    identity = identity || getRealPath();
    let query = new AV.Query('Timer');
    return new Promise((resolve, reject) => {
      query.equalTo("identity", identity);
      query.find().then(results => {
        resolve(results.length > 0);
      }, error => reject(error));
    })
  }

  const _get = (identity) => {
    let query = null;
    if(identity && identity instanceof Array){
      let querys = [];
      for(let i = 0; i < identity.length; ++i) {
        querys[i] = new AV.Query('Timer');
        querys[i].equalTo('identity', identity[i]);
      }
      query = AV.Query.or.apply(null ,querys);
    } else {
      identity = identity || getRealPath();
      query = new AV.Query("Timer");
      query.equalTo("identity", identity);
    }

    return new Promise((resolve, reject) => {
      query.find()
      .then(results => resolve(results))
      .catch(error => reject(error))
    })
  }

  const create = (identity) => {
    identity = identity || getRealPath();
    return new Promise((resolve, reject) => {
      let Todo = AV.Object.extend('Timer');
      let todo = new Todo();
      todo.set("times", 1);
      todo.set("identity", identity);
      todo.save().then(res => resolve(true), error => reject(error));
    })
  }

  const update = (identity) => {
    identity = identity || getRealPath();
    return new Promise((resolve, reject) => {
      let query = new AV.Query('Timer');
      query.equalTo("identity", identity);
      query.find().then(todos => {
        todos.forEach(todo => {
          todo.set("times", todo.attributes.times + 1);
        });
        return AV.Object.saveAll(todos);
      }).then(todos => resolve(true), error => reject(error));
    })
  }

  return {
    isExist,
    _get,
    update,
    create
  }
})()

const calcAndWriteTimes = () => {
  let isPost = true;

  let timerAllDOM = document.querySelectorAll(".article-timer");

  if(isPost) {
    let identity = timerAllDOM[0].getAttribute("data-identity");
    valineAPI.isExist(identity)
    .then(exist => {
      if(exist) {
        return valineAPI.update(identity);
      }
      return new Promise(resolve => resolve(true));
    })
    .then( succuess => valineAPI._get(identity))
    .then( result => timerAllDOM[0].innerText = result[0].attributes.times)
    .catch(error => console.log(error.message))
    return ;
  }

  let timerDOMCache = {};

  for(let timerDOM of timerAllDOM) {
    let identity = timerDOM.getAttribute("data-identity");
    if(timerDOMCache.hasOwnProperty(identity)){
      timerDOMCache[identity].dom.push(timerDOM);
    }else{
      timerDOMCache[identity] = {
        dom: [timerDOM],
        times: undefined
      };
    }
  }

  let identities = Object.keys(timerDOMCache);
  valineAPI._get(identities).then(results => {
    for(let result of results) {
      let {identity, times} = result.attributes;
      timerDOMCache[identity].times = times;
      timerDOMCache[identity].dom.map(item => item.innerText = times);
    }
    for(let identity of identities) {
      if(timerDOMCache[identity].times){
        continue;
      }
      timerDOMCache[identity].dom.map(item => item.innerText = 1);
      valineAPI.create(identity);
    }
  }).catch(error => console.log(error.message))
}

if(true){
  calcAndWriteTimes();
}
</script>
   

</div>


      <footer>
  <p class="site-info">
    博客已运行<span id="time-to-now"></span><span class="my-face">(●'◡'●)ﾉ♥</span>
    <br>
    Created By <a href="https://hexo.io/zh-cn/">Hexo</a> | Theme - <a href="https://github.com/dongyuanxin/theme-bmw">BMW</a>  
    <br>
    
      <a href="https://www.google.com/analytics/" target="_blank">Google Analytics</a> 提供网站统计服务.  <br> 
    
  </p>
</footer>



<script>
const timeToNowDOM = document.querySelector("#time-to-now");
const startTimestamp = new Date(2018, 2, 10).getTime();

const updateTimeStr = () => {
  let offset = parseInt(
      (new Date().getTime() - startTimestamp) / 1000,
      10
    ),
    day = Math.floor(offset / 86400),
    hour = Math.floor((offset % 86400) / 3600),
    minute = Math.floor(((offset % 86400) % 3600) / 60),
    second = Math.floor(((offset % 86400) % 3600) % 60);
  timeToNowDOM.innerHTML =
    day + "天" + hour + "小时" + minute + "分钟" + second + "秒";
  setTimeout(updateTimeStr, 500);
}

setTimeout(updateTimeStr, 500);
</script>


      <div class="back-to-top hidden">
  <span>
    <i class="iconfont icon-60"></i><span></span>%
  </span>
</div>

<script>
const updateIconToTop = percent => {
  let dom = document.querySelector(".back-to-top span span");
  dom.innerText = percent;
  if(percent < 1) {
    document.querySelector(".back-to-top").className = "back-to-top hidden";
  } else {
    document.querySelector(".back-to-top").className = "back-to-top";
  }
}

const handleScoll = () => {
  let isRunning = false;
  return () => {
    if (isRunning) return;
    isRunning = true;
    window.requestAnimationFrame(timestamp => {
      let scrollTop =
          document.documentElement.scrollTop || document.body.scrollTop,
        scrollHeight =
          document.documentElement.scrollHeight ||
          document.body.scrollHeight,
        clientHeight =
          document.documentElement.clientHeight ||
          document.body.clientHeight;
      isRunning = false;
      if (scrollTop <= 1) {
        updateIconToTop(0);
        return;
      }
      if (scrollTop + clientHeight >= scrollHeight) {
        updateIconToTop(100);
      } else {
        updateIconToTop(parseInt(
          100 * scrollTop / (scrollHeight - clientHeight),
          10
        ));
      }
    });
  };
}

const backToTop = () => {
  let scrollTop =
      document.documentElement.scrollTop || document.body.scrollTop,
    delay = 10,
    time = 200;
  if (scrollTop <= 20) {
    document.documentElement.scrollTop = 0;
    document.body.scrollTop = 0;
    return;
  }
  let step = Math.ceil(scrollTop * delay / time);
  let timer = setInterval(() => {
    scrollTop =
      document.documentElement.scrollTop || document.body.scrollTop;
    if (scrollTop - step <= 0) {
      document.documentElement.scrollTop = 0;
      document.body.scrollTop = 0;
      clearInterval(timer);
    } else {
      document.documentElement.scrollTop = scrollTop - step;
      document.body.scrollTop = scrollTop - step;
    }
  }, delay);
}

document.addEventListener("scroll", handleScoll(), false);

document.querySelector(".back-to-top").addEventListener("click", backToTop, false);

</script>

    </div>

    
      <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script>
<script>
  (() => {
    const mathjaxConfig = {
      showProcessingMessages: false, //关闭js加载过程信息
      messageStyle: "none", //不显示信息
      jax: ["input/TeX", "output/HTML-CSS"],
      tex2jax: {
        inlineMath: [["$", "$"], ["\\(", "\\)"]], //行内公式选择符
        displayMath: [["$$", "$$"], ["\\[", "\\]"]], //段内公式选择符
        skipTags: ["script", "noscript", "style", "textarea", "pre", "code", "a"] //避开某些标签
      },
      "HTML-CSS": {
        availableFonts: ["STIX", "TeX"], //可选字体
        showMathMenu: false //关闭右击菜单显示
      }
    }

    let mathjaxInterval = setInterval(() => {
      if(!window.MathJax){
        return;
      }
      window.MathJax.Hub.Config(mathjaxConfig)
      window.MathJax.Hub.Queue(["Typeset", MathJax.Hub, document.getElementById('app')])

      clearInterval(mathjaxInterval)
    }, 10)    
  })()
</script>
    

    <script src="https://cdn.bootcss.com/fancybox/3.5.2/jquery.fancybox.min.js" async></script>
<script async>
  let fancyTimer = setInterval(function(){
    if(!window.$){
      return;
    }
    $(document).ready(function() {
      $(".post img").each(function () {
        if($(this).parent().get(0).tagName.toLowerCase() === "a") {
          return;
        }
        // $(this).attr("data-fancybox", "gallery"); // if you add 'data-fancybox', img will display after showed
        var element = document.createElement("a");
        $(element).attr("data-fancybox", "gallery");
        $(element).attr("href", $(this).attr("src"));
        $(this).wrap(element);
      });
      
      clearInterval(fancyTimer);
    });
  }, 10);
</script>

    
  </body>

</html>
